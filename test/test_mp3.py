from header import Header
from main_data import MainData
from mp3 import MP3File
from side_info import SideInfo
from utils.bit import byte2str


def frame_test():
    raw_frame = b'''
        \xFF\xFB\x92\x64\x29\x8F\x73\xC4\x69\xBE\x80\x43\x6B\x72
        \x67\x4D\x87\xD8\x0C\x63\x6E\x0C\xBD\xB1\x06\x01\x05\x6D\xC9\x99
        \xB5\x60\x94\x21\xA1\xBB\x20\x82\x96\x9A\x67\xCC\xD3\x4D\x34\x93
        \x4D\x33\x32\x4C\xDD\x37\x53\xA6\xF4\x1A\x83\x34\xCC\x39\x61\x17
        \x04\xEC\x2A\xE3\x0E\x43\x29\x98\x19\xB8\x30\x8C\x08\x00\x00\x02
        \xEF\x9D\xD7\x20\x91\x13\x8D\xC8\xBB\x99\xDA\xFE\x46\x98\x47\xE0
        \x42\xEB\x7A\x6A\x88\x9D\x4D\xDC\xC9\x0B\x58\x59\x20\x84\xE6\xF9
        \x13\xBD\x29\xA6\xE7\xA0\xB1\x67\xDD\xC3\x8B\xCD\xCE\x02\x48\xA9
        \x6E\x74\x59\x19\x44\x47\x73\xE3\x20\x8A\xE2\xDC\xC2\x01\xBB\xFB
        \x87\x3E\x81\xB9\xFB\xE2\xCA\xEE\xF7\x24\x34\x8E\x99\x44\x37\x78
        \x5F\xEE\x70\xAB\xBB\x99\xED\xC2\x71\x79\x1D\x24\xDC\x0D\xD3\x73
        \x78\x82\x0C\x6E\x77\x44\xA2\x5D\x74\x9C\xC8\xCA\x15\x29\x88\x22
        \x7C\x97\x65\xA3\x69\x3A\x23\x90\x0E\x6D\x30\x7C\xDD\x4F\x53\x13
        \xDC\xBE\x79\x9F\x65\x55\xFC\x7F\xF3\x1B\x2F\xEE\xBF\xF9\xBF\xF6
        \xFD\xC3\x9F\x5D\xCC\xEC\x98\xBE\xFA\x8D\xD4\xCE\x37\xCD\xD3\xBD
        \xEF\x77\x35\x6E\x63\x6F\x8B\x7F\xC7\xCF\x2F\x6C\xDB\x59\x55\x4F
        \x39\x34\xC6\xA2\x6F\x7E\x84\x9A\x20\x4A\x1D\x44\x39\x10\x14\x1E
        \xC6\xC2\xB5\x06\xC1\xD8\x4C\x60\x00\x9D\xD1\x1E\xEE\xCF\x12\x0C
        \x8A\xAD\x61\x8E\xEE\x85\x72\xAA\xF0\xD2\x25\xF9\xF9\xAE\xA6\x44
        \x87\x5F\xD7\x2F\x9F\x77\x36\xAB\xD4\x42\xD2\x4E\x33\xD6\xA7\xDB
        \xFF\xBF\xEE\x6D\x7A\x7E\x92\x9E\xE6\xBA\x68\x87\x44\x96\x56\x8F
        \xD9\xA2\x38\xE2\xFE\x7A\x74\xAD\x63\x8B\x81\xF7\xCC\x75\x0D\xBB
        \xEF\xF2\xD0\xCA\xB1\x47\x4B\xD5\xBF\xCD\xD3\xFA\x53\x0A\x38\xE7
        \x06\xE1\x78\x1A\x0D\xE0\x14\x08\xC1\xE1\x82\x84\x88\xE3\xD8\x1A
        \xBB\x7A\x55\x4E\xB7\xA7\x78\xD9\xC6\xA4\x07\xB0\x16\x4B\xA9\xA4
        \x74\x74\xBC\x8B\x47\xBB\xD9\xE7\x26\x63\x21\xBA\xFD\x2C\xED\x9C
        \xC6\xD5\x5D\x59'''
    buf=b'\xFF\xFB\x92\x64'
    bytes_str = byte2str(buf, 4)
    print(bytes_str)
    header = Header(bytes_str)
    raw_frame=raw_frame[6:] # 2bytes for CRC

    buf=b'''
        \x73\xC4\x69\xBE\x80\x43\x6B\x72
        \x67\x4D\x87\xD8\x0C\x63\x6E\x0C\xBD\xB1\x06\x01\x05\x6D\xC9\x99
        \xB5\x60\x94\x21\xA1\xBB\x20\x82''' # stereo
    bytes_str = byte2str(buf, 32)
    side_info = SideInfo(bytes_str, header.channel_mode)
    main_data_length = header.frame_size - (4+2+32)
    print("main data length:",main_data_length)
    buf=b'''
        \x96\x9A\x67\xCC\xD3\x4D\x34\x93
        \x4D\x33\x32\x4C\xDD\x37\x53\xA6\xF4\x1A\x83\x34\xCC\x39\x61\x17
        \x04\xEC\x2A\xE3\x0E\x43\x29\x98\x19\xB8\x30\x8C\x08\x00\x00\x02
        \xEF\x9D\xD7\x20\x91\x13\x8D\xC8\xBB\x99\xDA\xFE\x46\x98\x47\xE0
        \x42\xEB\x7A\x6A\x88\x9D\x4D\xDC\xC9\x0B\x58\x59\x20\x84\xE6\xF9
        \x13\xBD\x29\xA6\xE7\xA0\xB1\x67\xDD\xC3\x8B\xCD\xCE\x02\x48\xA9
        \x6E\x74\x59\x19\x44\x47\x73\xE3\x20\x8A\xE2\xDC\xC2\x01\xBB\xFB
        \x87\x3E\x81\xB9\xFB\xE2\xCA\xEE\xF7\x24\x34\x8E\x99\x44\x37\x78
        \x5F\xEE\x70\xAB\xBB\x99\xED\xC2\x71\x79\x1D\x24\xDC\x0D\xD3\x73
        \x78\x82\x0C\x6E\x77\x44\xA2\x5D\x74\x9C\xC8\xCA\x15\x29\x88\x22
        \x7C\x97\x65\xA3\x69\x3A\x23\x90\x0E\x6D\x30\x7C\xDD\x4F\x53\x13
        \xDC\xBE\x79\x9F\x65\x55\xFC\x7F\xF3\x1B\x2F\xEE\xBF\xF9\xBF\xF6
        \xFD\xC3\x9F\x5D\xCC\xEC\x98\xBE\xFA\x8D\xD4\xCE\x37\xCD\xD3\xBD
        \xEF\x77\x35\x6E\x63\x6F\x8B\x7F\xC7\xCF\x2F\x6C\xDB\x59\x55\x4F
        \x39\x34\xC6\xA2\x6F\x7E\x84\x9A\x20\x4A\x1D\x44\x39\x10\x14\x1E
        \xC6\xC2\xB5\x06\xC1\xD8\x4C\x60\x00\x9D\xD1\x1E\xEE\xCF\x12\x0C
        \x8A\xAD\x61\x8E\xEE\x85\x72\xAA\xF0\xD2\x25\xF9\xF9\xAE\xA6\x44
        \x87\x5F\xD7\x2F\x9F\x77\x36\xAB\xD4\x42\xD2\x4E\x33\xD6\xA7\xDB
        \xFF\xBF\xEE\x6D\x7A\x7E\x92\x9E\xE6\xBA\x68\x87\x44\x96\x56\x8F
        \xD9\xA2\x38\xE2\xFE\x7A\x74\xAD\x63\x8B\x81\xF7\xCC\x75\x0D\xBB
        \xEF\xF2\xD0\xCA\xB1\x47\x4B\xD5\xBF\xCD\xD3\xFA\x53\x0A\x38\xE7
        \x06\xE1\x78\x1A\x0D\xE0\x14\x08\xC1\xE1\x82\x84\x88\xE3\xD8\x1A
        \xBB\x7A\x55\x4E\xB7\xA7\x78\xD9\xC6\xA4\x07\xB0\x16\x4B\xA9\xA4
        \x74\x74\xBC\x8B\x47\xBB\xD9\xE7\x26\x63\x21\xBA\xFD\x2C\xED\x9C
        \xC6\xD5\x5D\x59'''
    bytes_str = byte2str(buf, main_data_length)
    print(len(bytes_str))
    main_data = MainData(header, side_info, bytes_str)

def mp3_test():
    song_path = r'E:\study\else\pydemp3\test\noid3.mp3'
    mp3 = MP3File(song_path)
    mp3.read_frames(100)
    mp3.save_as_wav('hello.wav')



if __name__=='__main__':
    # frame_test()
    mp3_test()